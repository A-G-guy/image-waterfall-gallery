# 思源笔记 - 瀑布流画廊插件

[English](README.md) | 简体中文

## 📖 插件简介

瀑布流画廊插件为思源笔记提供了沉浸式的图片浏览体验。当您打开带有 `#gallery` 标签的文档时,插件会自动提取文档中的所有图片,并以精美的瀑布流布局全屏展示,让您可以专注于欣赏图片内容,而不受文字干扰。

## ✨ 功能特性

### 画廊浏览

- 🎯 **自动触发**:打开带有 `#gallery` 标签的文档时自动进入画廊模式
- 🖼️ **瀑布流布局**:采用等宽不等高的瀑布流布局,充分利用屏幕空间
- 🔍 **灯箱查看**:点击图片可在灯箱中查看大图,支持左右切换
- 🎨 **主题适配**:自动适配思源笔记的深色/浅色主题
- 📱 **响应式设计**:支持桌面端和移动端,自动调整列数
- ⚡ **性能优化**:图片懒加载,提升加载速度
- 🎭 **优雅动画**:淡入动画效果,提供流畅的视觉体验
- ⌨️ **快捷操作**:支持 ESC 键快速退出画廊模式

### 画廊管理

- 📂 **文件管理**:查看和管理所有带有 `#gallery` 标签的文档
- 🔄 **文件排序**:支持按创建日期(正序/倒序)或引用顺序排序
- 🖼️ **图片管理**:查看单个画廊文件的所有图片详情
- ➕ **添加图片**:通过文件选择器上传图片到附件并自动插入文档
- 🗑️ **删除引用**:删除图片引用(保留附件文件),带双重确认保护
- 📊 **图片排序**:支持按块顺序、路径正序/倒序排序画廊内的图片

### 插件设置

- 🎲 **图片顺序**:设置瀑布流中图片的显示顺序(随机/顺序/倒序)
- 💻 **桌面端宽度**:自定义桌面端瀑布流图片宽度(200-600px)
- 📱 **移动端宽度**:自定义移动端瀑布流图片宽度(200-600px)
- 🌐 **跨平台适配**:自动检测平台并应用对应的宽度设置

## 📦 安装方法

### 方法一:集市安装(推荐)

1. 打开思源笔记
2. 进入 `设置` → `集市` → `插件`
3. 搜索 "瀑布流画廊" 或 "Image Waterfall Gallery"
4. 点击 `下载` 并启用插件

### 方法二:手动安装

1. 下载最新版本的 `package.zip`
2. 解压到思源笔记的 `data/plugins/` 目录
3. 重启思源笔记
4. 在 `设置` → `插件` 中启用插件

## 🚀 使用方法

### 基础使用

1. 创建或打开一个包含图片的文档
2. 为文档添加 `#gallery` 标签
   - 点击文档标题右侧的 `...` 菜单
   - 选择 `属性` → `标签`
   - 输入 `gallery` 并保存
3. 切换到该文档时,插件会自动进入画廊模式

### 退出画廊模式

- 按 `ESC` 键
- 点击右上角的关闭按钮 `✕`

### 使用画廊管理功能

1. 打开插件设置(设置 → 插件 → 瀑布流画廊)
2. 点击 `管理画廊文件` 按钮
3. 在画廊文件列表中:
   - 使用排序选择器调整文件显示顺序
   - 点击 `管理` 按钮进入单个画廊的详细管理
4. 在单个画廊管理界面中:
   - 使用排序选择器调整图片显示顺序
   - 点击 `+ 添加图片` 上传新图片到画廊
   - 点击图片可在灯箱中查看大图
   - 点击 `删除` 按钮删除图片引用(需双重确认)

### 配置插件设置

1. 打开插件设置(设置 → 插件 → 瀑布流画廊)
2. 配置以下选项:
   - **图片顺序**: 选择瀑布流中图片的显示顺序
   - **桌面端图片宽度**: 设置桌面端图片宽度(默认 350px)
   - **移动端图片宽度**: 设置移动端图片宽度(默认 300px)
3. 点击确认保存设置

### 使用场景

- 📸 **摄影作品集**:展示您的摄影作品
- 🎨 **设计灵感库**:收集和浏览设计灵感
- 🖼️ **艺术画廊**:欣赏艺术作品
- 📚 **图片笔记**:浏览图片密集型笔记

## ⚙️ 技术架构

### 核心技术

- **监听机制**:使用 `eventBus.on("switch-protyle")` 监听文档切换
- **数据查询**:通过 SQL API 查询文档标签和图片块
- **布局方案**:CSS Multi-column 实现纯 CSS 瀑布流
- **主题适配**:使用思源 CSS 变量(如 `var(--b3-theme-background)`)

### 文件结构

```text
image-waterfall-gallery/
├── src/
│   ├── index.ts          # 核心逻辑
│   └── index.scss        # 样式文件
├── plugin.json           # 插件配置
├── icon.png             # 插件图标
└── README.md            # 说明文档
```

## 🔧 开发说明

### 环境要求

- Node.js >= 16
- pnpm 或 npm

### 开发步骤

```bash
# 安装依赖
npm install

# 开发模式
npm run dev

# 生产构建
npm run build
```

### 构建产物

- `dist/index.js` - 主程序
- `dist/index.css` - 样式文件
- `package.zip` - 插件包

## 📝 更新日志

### v1.0.1 (2025-12-24)

- 🐛 修复平台检测逻辑,支持桌面端和移动端独立的图片宽度设置
- 🐛 修复添加图片按钮,改为文件选择器并上传到附件
- 🐛 为删除功能添加强警告,包含两步确认和详细说明
- 🐛 修复图片排序逻辑,为单个画廊管理页面添加图片排序功能

### v1.0.0 (2025-12-23)

- 🎉 首次发布
- ✨ 实现自动瀑布流画廊功能
- 🎨 支持主题适配
- 📱 支持响应式布局
- ⚡ 图片懒加载优化

## 🤝 贡献

欢迎提交 Issue 和 Pull Request!

## 📄 许可证

MIT License

## 🙏 致谢

感谢思源笔记团队提供的优秀平台和完善的插件 API。

---

**提示**:如果您喜欢这个插件,欢迎给个 ⭐ Star!
